csvstack -g Medecin,Interne -n ORIGIN data/raw/medecins_exploitables.csv data/raw/internes_exploitables.csv |\
    csvcut -c ORIGIN,company_name,name,address,expertise,rpps,convention_date,convention_kind,benefit_value,benefit_date,benefit_kind,establishment |\
    sed 's/\([0-9][0-9]\)\/\([0-9][0-9]\)\/\([0-9][0-9][0-9][0-9]\)/\3-\2-\1/g' |\
    sed 1d | perl -e 'while (<STDIN>) {@a = split /,/; $a[2] =~ s/^(Docteur|Dr |Dr$|PROFESSEUR|MEDECIN|Pr |Intervenant|Chirurgien|médecin|Médecine|Endocrinologie|Sans|Praticien|Hématologie|Oncologie|M |ANESTHESIE|Pharmacien|MONSIEUR|MADAME|CHIRURGIEN|Pédiatrie) ?//i; $_ = join ",", @a; print $_;}' \
    > data/tmp/medecins_exploitables.csv

echo "ORIGIN,LABO,BENEF_PS_QUALITE_NOM_PRENOM,BENEF_PS_ADR,BENEF_PS_QUALIFICATION,BENEF_PS_RPPS,DECL_CONV_DATE,DECL_CONV_OBJET,DECL_CONV_PROGRAMME,DECL_AVANT_MONTANT,DECL_AVANT_DATE,DECL_AVANT_NATURE,BENEF_ETUD_ETA,BENEF_PS_CODEPOSTAL" > data/tmp/headers_exploitables.csv
cat data/tmp/headers_exploitables.csv > data/formatted/medecins_exploitables.formatted.csv
cat data/tmp/medecins_exploitables.csv | perl -e 'while(<STDIN>){chomp; while(s/"([^"]*),([^"]*)"/"\1 -\2"/g){}; @a = split /,/; $a[13] = $a[3] ; $a[13] =~ s/(^|.* )([0-9]{5}) .*/\2/; $a[13] = sprintf("%05d", $a[13]*1); $a[13] = "" unless ($a[13]*1); print join ",", @a; print "\n";}' >> data/formatted/medecins_exploitables.formatted.csv
rm data/tmp/medecins_exploitables.csv
